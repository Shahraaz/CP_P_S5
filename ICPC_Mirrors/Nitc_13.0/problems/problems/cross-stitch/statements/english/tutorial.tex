\begin{tutorial}{Cross-Stitch}

{
    \parindent=1cm
    \begin{tabular}{l@{\extracolsep{1cm}}l}
         Идея задачи: & Георгий Корнеев\\
         Условие: & Георгий Корнеев\\
         Проверяющая программа: & Георгий Корнеев\\
         Тесты: & Георгий Корнеев\\
     \end{tabular}
}

В этой задаче необходимо составить схему вышивки крестом заданного узора, требующую нить минимальной длины.

Заменим в узоре каждый крест на <<бабочку>> из двух лицевых и двух изнаночных стежков, как показано на схеме:

\begin{center}
\includegraphics{cross-stitch-2.ps}
\end{center}

В результате замены между соседними по горизонтали крестами могут возникнуть кратные ребра, которые надо будет аккуратно обработать в решении.

Заметим, что если два креста были соседями по вертикали, горизонтали или диагонали, то у соответствующих им бабочек есть общая вершина. Так как исходное множество крестов 8-связно, то построенный граф так же будет связным.

В построенном графе, число лицевых ребер (стежков), входящих в каждую вершину равно числу изнаночных ребер выходящих из него, и наоборот. Таким образом, алгоритмом аналогичным поиску эйлерова цикла в этом графе можно построить цикл, проходящий по всем ребрам, в котором лицевые и изнаночные ребра чередуются. Разорвем этом цикл по произвольному изнаночному ребру и получим путь из $n$ лицевых и $n-1$ изнаночного стежка. Так как меньше чем $n-1$ изнаночных стежков сделать нельзя, и каждый такой стежок должен иметь длину не меньше 1, то длина построенного пути минимальна.

Так как построенный граф имеет $O(n^2)$ вершин и ребер, то искомый путь в нем можно найти, затратив $O(n^2)$ времени и памяти.

\end{tutorial}
