{"scoring":null,"notes":"In the first example, the ball trajectories look as shown:\r\n\r\n\\begin{center}\r\n\\includegraphics{a-1}\r\n\\end{center}\r\n\r\nIn the second example, starting positions $1$ and $3$ coincide, and for\r\nthe position $2$ the ball will never stop:\r\n\r\n\\begin{center}\r\n\\includegraphics{a-2}\r\n\\end{center}","legend":"Galina is an aspiring golfer and spends all her free time at a minigolf park. Her favorite golf course in this park is a rectangle, with one of its sides parallel to the north-south direction, and the other one parallel to the east-west direction. The ball is really small and can be considered a point.\r\n\r\nGalina wants to practice a specific shot called ``put''. In this shot, a ball is placed somewhere inside the golf course and hit north-east, obtaining the speed of $\\sqrt{2}$ inches per second. This means that the ball starts moving by exactly $1$ inch to the north and $1$ inch to the east per second. \r\n\r\nThe golf park uses an innovative technology that eliminates all friction, and the ball will continue to move at the initial speed regardless of the traveled distance. Collisions with golf course borders will be perfectly elastic. Fancy!\r\n\r\nInside the course there is a pond that is represented as a simple polygon with edges parallel to the sides of the golf course. If the ball touches the pond, it sinks momentarily.\r\n\r\nYou are given a list of starting coordinates for Galina's next put training session. For each starting position, assuming a put is shot from this place, calculate how long the ball will travel before falling into the pond and find exactly where it happens, or determine that the ball will move indefinitely.","authorLogin":"tourist","language":"english","timeLimit":2000,"output":"For each starting point in order of input, output either a single integer $-1$ if the ball will never sink, or three integers $\\tau$ $x_s$ $y_s$, denoting the time before the ball sinks in seconds, and coordinates of the point where it happens ($\\tau > 0$; $1 \\le x_s \\le w - 1$; $1 \\le y_s \\le h - 1$). Point $(x_s, y_s)$ must belong to the border of the pond.","inputFile":"stdin","outputFile":"stdout","input":"The first line contains two integers $w$ and $h$, the width and the height of the golf course in inches ($4 \\le w, h \\le 5 \\cdot 10^8$). A coordinate system is introduced in such a way that the corners of the golf course have coordinates $(0, 0)$, $(w, 0)$, $(w, h)$, $(0, h)$, and the point $(1, 1)$ is to the north-east of the point $(0, 0)$.\r\n\r\nThe second line contains a single integer $n$, denoting the number of vertices in the polygon ($4 \\le n \\le 1000$).\r\n\r\nEach of the following $n$ lines contains two integers $x_i$ and $y_i$, denoting the coordinates of the $i$-th vertex ($1 \\le x_i \\le w - 1$; $1 \\le y_i \\le h - 1$). The vertices are listed in traversal order.\r\n\r\nAll polygon vertices are distinct and none of them lie at the polygon's edge.\r\nAll polygon edges are either vertical ($x_i = x_{i+1}$; $x_n=x_1$) or horizontal ($y_i = y_{i+1}$; $y_n=y_1$), and none of them intersects another.\r\n\r\nThe next line contains a single integer $t$, denoting the number of starting points for a shot ($1 \\le t \\le 100$).\r\n\r\nEach of the following $t$ lines contains two integers $\\tilde{x}_i$ and $\\tilde{y}_i$, denoting the coordinates of the $i$-th starting point ($1 \\le \\tilde{x}_i \\le w - 1$; $1 \\le \\tilde{y}_i \\le h - 1$). No starting point lies inside or on the border of the pond.\r\n\r\nNote that all starting points are independent of each other. In particular, you can assume that there is exactly one ball inside the golf course at any moment.\r\n","authorName":"Gennady Korotkevich","sampleTests":[{"output":"2 4 4\r\n3 4 6\r\n13 3 4\r\n15 2 4\r\n","input":"10 8\r\n6\r\n1 4\r\n1 5\r\n3 5\r\n3 6\r\n4 6\r\n4 4\r\n4\r\n2 2\r\n1 7\r\n4 7\r\n7 5\r\n","inputFile":"example.01","outputFile":"example.01.a"},{"output":"3 4 4\r\n-1\r\n3 4 4\r\n","input":"6 6\r\n4\r\n2 2\r\n4 2\r\n4 4\r\n2 4\r\n3\r\n5 5\r\n5 2\r\n5 5\r\n","inputFile":"example.02","outputFile":"example.02.a"}],"name":"Golf Time","interaction":null,"memoryLimit":536870912,"tutorial":"{\r\n    \\parindent=1cm\r\n    \\begin{tabular}{l@{\\extracolsep{1cm}}l}\r\n         Idea: & Georgiy Korneev\\\\\r\n         Statement: & Gennady Korotkevich\\\\\r\n         Checker: & Gennady Korotkevich\\\\\r\n         Tests: & Gennady Korotkevich\\\\\r\n     \\end{tabular}\r\n}\r\n\r\nWhen a ball sinks, it touches some side of polygon. Let's brute-force which one, solve separately for all of them, and choose minimal value. \r\n\r\nConsider one segment. Let's say it's vertical (horizontal case can be handled in same way), so it's $x = x_1, y_1 \\le y \\le y_2$. Also, let stating position of ball be $x_0, y_0$. \r\n\r\nTo make solving more convenient, instead of reflecting ball trajectory, one can reflect the golf course. If such transformation is done, problem becomes following: ball is running over line $(x_0 + t, y_0 + t)$, and there is infinite number of segments, located on $2\\cdot w \\time 2\\cdot h$-regular grid. More formally, our segment is transformed to 4 series of segments \r\n\\begin{itemize}\r\n\\item $x = x_1 + 2\\cdot k \\cdot w, y_1 + 2\\cdot l * h \\le y \\le y_2 + 2\\cdot l * h$\r\n\\item $x = 2 \\cdot w - x_1 + 2\\cdot k \\cdot w, y_1 + 2\\cdot l * h \\le y \\le y_2 + 2\\cdot l * h$\r\n\\item $x = x_1 + 2\\cdot k \\cdot w, 2 \\cdot h - y_2 + 2\\cdot l * h \\le y \\le 2 \\cdot h - y_1 + 2\\cdot l * h$\r\n\\item $x = 2 \\cdot w - x_1 + 2\\cdot k \\cdot w, 2 \\cdot h - y_2 + 2\\cdot l * h \\le y \\le 2 \\cdot h - y_1 + 2\\cdot l * h$\r\n\\end{itemize}\r\nwhere k and l are any integers. For each series problem can be solved independently, than minimal solution should be gotten. \r\n\r\nConsider one series. From equation we can get that all valid values of $t$ for this equation have form $a + k \\cdot (2 \\cdot w)$, if $a$ is smallest valid value. At that point, value of $k$ should be non-negative, and should be minimized. Let's check if $k = 0$ is solution for second inequality for some $l$. If it is we are done. Otherwise, problem is reduced to finding minimal integer solutions of inequality of form $l \\le (a \\cdot k) \\bmod m \\le r$, for some known values of all variables except $k$.\r\n\r\nThis inequality can be solved by handling several cases. \r\n\r\n\\begin{itemize}\r\n\\item If $2 \\cdot a$ is greater than $m$ solve $m - r \\le ((m - a) \\cdot k) \\bmod m \\le m - l$ instead. \r\n\\item If $\\left\\lceil \\frac{l}{a}\\right\\rceil$ is solution, it's minimal one, and we are done.\r\n\\item Otherwise, if $m$ is divisible by $a$ no solution exists.\r\n\\item Otherwise, consider first value after wrapping around modulo. Each step it's decreased by $m \\bmod a$ modulo $a$. We need to find first point where this value is between $l \\bmod a$ and $r \\bmod a$. As no solution was found in case 2, first value is less then second. Finding such a value is equal to solve an inequality $(l \\bmod a) \\le (a - (m \\bmod a)) \\cdot k' \\le (r \\bmod a)$, which can be done recursively. \r\nAfter this inequality solved, the value $\\left\\lceil \\frac{k' \\cdot m + l}{a} \\right\\rceil$ is the minimal solution. If there is no solution --- there is no solution for original inequality too. \r\n\\end{itemize} \r\n\r\nComplexity of such inequality solving is $O(\\log m)$, because after step 1, $a$ is at least two times less. Total complexity is $O(t \\cdot n \\cdot \\log (wh))$, which is fast enough. \r\n\r\n{\r\n    \\parindent=1cm\r\n    \\begin{tabular}{l@{\\extracolsep{1cm}}l}\r\n         Идея задачи: & Георгий Корнеев\\\\\r\n         Условие: & Геннадий Короткевич\\\\\r\n         Проверяющая программа: & Геннадий Короткевич\\\\\r\n         Тесты: & Геннадий Короткевич\\\\\r\n     \\end{tabular}\r\n}\r\n\r\nМяч тонет в момент касания одной из сторон многоугольника. Переберем все стороны и найдем время первого касания для каждой из них. Тогда ответом на задачу, будет минимальное среди полученных времен.\r\n\r\nРассмотрим сторону $i$. Не уменьшая общности, будем считать что она вертикальная (случай горизонтальной стороны решается аналогично с точностью до замены координат). Введем обозначения $x_s=x_{i,1}=x_{i,2}$, $y_1=y_{i,1}$ и $y_2=y_{i,2}$, тогда отрезок будет иметь вид $x=x_s$ и $y_1 \\le y \\le y_2$.\r\n\r\nДля удобства, вместо отражения мяча от сторон поля для гольфа, будет отражать само поле. При этом, мяч будет лететь по прямой $(\\tilde{x} + t, \\tilde{y} + t)$, а рассматриваемая сторона многоугольника даст бесконечную последовательность отрезков на решетке размера $2\\cdot w \\time 2\\cdot h$. Выпишем явным образом все виды этих отрезков:\r\n\\begin{shortitems}\r\n\\item $x = 2wk + x_s$, $2hl + y_1 \\le y \\le 2hl + y_2$\r\n\\item $x = 2wk + x_s$, $2hl + 2h - y_2 \\le y \\le 2hl + 2h - y_1$\r\n\\item $x = 2wk + 2w - x_s$, $2hl + y_1 \\le y \\le 2hl + y_2$\r\n\\item $x = 2wk + 2w - x_s$, $2hl + 2h - y_2 \\le y \\le 2hl + 2h - y_1$\r\n\\end{shortitems}\r\nгде $k$ и $l$~--- целые числа. \r\nЗаметим, что каждый вид отрезков можно задать как $x=2wk+\\overline{x}$, $2hl + \\overline{y}_1 \\le y \\le 2hl + \\overline{y}_2$, для некоторых $\\overline{x}$ и $\\overline{y}$. Решим задачу отдельно для отрезка каждого вида и выберем среди полученных времен минимальное. \r\n\r\nТраектория мяча пересекает последовательность прямых вида $x=2wk+\\overline{x}$ с периодом $2w$. Таким, образом, времена пересечения имеют вид $t_k=t_0 + 2wk$ для некоторого $0 \\le t_0 < 2w$ и $k \\ge 0$. Найдем решение с минимальным $k$. В начале проверим $k = 0$. Если $\\overline{y}_1 \\le \\tilde{y} + t_0 \\le 2hl \\le \\overline{y}_2$, то ответ найден. В противном случае, задача свелась к поиску минимального решения диофантового неравества вида $L \\le ak \\bmod m \\le R$, где $m=2hl$, $a=2w$, $L=(\\overline{y}_1 - \\tilde{y}) \\bmod m$, $R=(\\overline{y}_2 - \\tilde{y}) \\bmod m$.\r\n\r\nРешим это неравенство, рассмотрев несколько случаев\r\n\r\n\\begin{shortnums}\r\n\\item Если $2a > m$, то сведем к решению неравенства $m - R \\le ((m - a)k) \\bmod m \\le m - L$. \r\n\\item Если $k=\\left\\lceil \\frac{L}{a}\\right\\rceil$ являетсе решением, но оно минимальное.\r\n\\item Иначе, если $m$ делится на $a$, то решений не существует.\r\n\\item Иначе, рассмотрим первые значения, после каждого переполнения по модулю $m$. Каждый раз оно будет изменяться на $m \\bmod a$. Нам требуется найти минимальное значение, которое удовлетворяет по модулю $a$ попадет в отрезок $L \\bmod a..R \\bmod a$. Так как решение не было найдено во втором случае, то $k=\\left\\lceil \\frac{L}{a}\\right\\rceil$ не является решением и $L \\bmod a < R \\bmod a$. Таким образом, мы свели задачу к решению неравенства $(L \\bmod a) \\le ((a - (m \\bmod a)) \\cdot k' \\le (R \\bmod a)$. Решим его тем же алгоритмом. Пусть $k'$~--- минимальное решение нового неравенства, тогда $\\left\\lceil \\frac{k'm + l}{a} \\right\\rceil$~--- минимальное решение исходного неравества. Если новое неравенство не имеет решений, то исходного неравенство так же не имеет решение.\r\n\\end{shortnums}\r\n\r\nВременная сложность алгоритма решения неравества будет $O(\\log m)$, так как после \r\nкаждого применения случая 1, $a$ уменьается как минимум в два раза. Таким образом, общая сложность полученного решения $O(tn\\log(wh))$. \r\n\r\n"}